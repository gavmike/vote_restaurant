/*C55*/SET SCHEMA PUBLIC
DISCONNECT
/*C56*/SET SCHEMA PUBLIC
DROP TABLE vote IF EXISTS
DROP TABLE menu IF EXISTS
DROP TABLE restaurant IF EXISTS
DROP TABLE user IF EXISTS
create table restaurant ( id int generated by default as identity (start with 1 increment by 1) primary key, name varchar(255) not null )
create table menu ( id int generated by default as identity (start with 1 increment by 1) primary key , name varchar(255) not null, price int not null, date timestamp default now not null, id_rest int, foreign key (id_rest) references restaurant(id) on delete cascade )
create table user ( id int generated by default as identity (start with 1 increment by 1) primary key , name varchar(255) not null, email varchar(255) not null, password varchar(255) not null, role varchar(255) not null )
create unique index user_unique_email_idx on user (email)
create table vote ( id int generated by default as identity (start with 1 increment by 1) primary key, date date not null, id_rest int not null, id_user int not null, foreign key (id_rest) references restaurant (id) on delete cascade, foreign key (id_user) references user (id) on delete cascade )
create unique index user_unique_date_vote_idx on vote (id_user, date)
create unique index menu_restaurant_date_unique on menu (date, id_rest)
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
INSERT INTO RESTAURANT VALUES(1,'MacDonalds')
COMMIT
INSERT INTO RESTAURANT VALUES(2,'KFC')
COMMIT
INSERT INTO MENU VALUES(1,'BigMac',444,'2019-08-17 00:00:00.000000',1)
INSERT INTO MENU VALUES(2,'CheeseBurger',1400,'2020-05-17 00:00:00.000000',1)
INSERT INTO MENU VALUES(3,'Fries',1400,'2020-05-24 00:00:00.000000',2)
INSERT INTO MENU VALUES(4,'Twister',232,'2019-08-17 00:00:00.000000',2)
INSERT INTO MENU VALUES(5,'BigMac2',555,'2020-05-24 00:00:00.000000',1)
COMMIT
INSERT INTO USER VALUES(1,'USER_1','user_1@yandex.ru','a123321','ROLE_USER')
COMMIT
INSERT INTO USER VALUES(2,'USER_2','user_2@yandex.ru','b123321','ROLE_USER')
COMMIT
INSERT INTO USER VALUES(3,'ADMIN','admin@mail.ru','a123321','ROLE_ADMIN')
COMMIT
INSERT INTO VOTE VALUES(1,'2019-10-12',1,2)
INSERT INTO VOTE VALUES(2,'2019-10-12',2,1)
INSERT INTO VOTE VALUES(3,'2019-11-12',2,3)
COMMIT
DISCONNECT
/*C57*/SET SCHEMA PUBLIC
DELETE FROM RESTAURANT WHERE ID=1
DELETE FROM RESTAURANT WHERE ID=2
DELETE FROM MENU WHERE ID=1
DELETE FROM MENU WHERE ID=2
DELETE FROM MENU WHERE ID=5
DELETE FROM VOTE WHERE ID=1
DELETE FROM MENU WHERE ID=3
DELETE FROM MENU WHERE ID=4
DELETE FROM VOTE WHERE ID=2
DELETE FROM VOTE WHERE ID=3
DELETE FROM USER WHERE ID=1
DELETE FROM USER WHERE ID=2
DELETE FROM USER WHERE ID=3
COMMIT
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C58*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C59*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C60*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C61*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C62*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C63*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C64*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C65*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C66*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C67*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C68*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C69*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C70*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C71*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C72*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C73*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C74*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C75*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C76*/SET SCHEMA PUBLIC
ALTER TABLE RESTAURANT ALTER COLUMN id RESTART WITH 1
ALTER TABLE MENU ALTER COLUMN id RESTART WITH 1
ALTER TABLE USER ALTER COLUMN id RESTART WITH 1
ALTER TABLE VOTE ALTER COLUMN id RESTART WITH 1
DISCONNECT
/*C77*/SET SCHEMA PUBLIC
DISCONNECT
